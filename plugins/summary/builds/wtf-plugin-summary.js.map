{"version":3,"file":"wtf-plugin-summary.js","sources":["../src/01-fromTemplate.js","../src/02-fromText.js","../src/index.js"],"sourcesContent":["const isObject = function(obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\nconst fromTemplate = function(doc) {\n  let tmpl = doc.template('short description')\n  if (tmpl && isObject(tmpl) && tmpl.description) {\n    return tmpl.description\n  }\n  return null\n}\nmodule.exports = fromTemplate\n","const nlp = require('compromise')\n\nconst defaults = {\n  max: 90,\n  min: 8\n}\n\nconst removeTitle = function(s, sentence, title) {\n  //remove bolds (longest-first)\n  let bolds = sentence.bolds().sort((a, b) => {\n    if (a.length > b.length) {\n      return -1\n    }\n    return 1\n  })\n  bolds.forEach(b => {\n    s = s.not(b)\n  })\n  s = s.not('^#Noun+ #Copula')\n  s = s.not(`^${title}`)\n  return s\n}\n\n//use commas, etc\nconst byClause = function(s) {\n  let orig = s.clone()\n  let clauses = s.clauses()\n  for (let i = 0; i < clauses.length; i += 1) {\n    let c = clauses.eq(i)\n    if (c.has('#Copula')) {\n      let result = clauses.slice(i, clauses.length)\n      result = result.not('^#Copula')\n      return result\n    }\n  }\n  return orig\n}\n\n// truncate a list of descriptions\nconst popList = function(s, options) {\n  let txt = s.text()\n  let almostMax = options.max * 0.75\n  if (txt.length > almostMax && s.has('and')) {\n    s = s.remove('and .*')\n  }\n  return s\n}\n\n//check text is appropriate length\nconst isGood = function(text, options) {\n  if (text && text.length > options.min && text.length < options.max) {\n    return true\n  }\n  return false\n}\n\nconst popArticle = function(doc) {\n  doc.remove('^(a|an|the)')\n  return doc\n}\n\n//\nconst extract = function(doc, options) {\n  options = options || {}\n  options = Object.assign({}, defaults, options)\n  let sentence = doc.sentences(0)\n  if (!sentence) {\n    return ''\n  }\n  let s = nlp(sentence.text())\n  let title = doc.title() || ''\n  //remove 'born-in' stuff\n  s.parentheses().remove()\n  //remove 'Toronto' from beginning\n  s = removeTitle(s, sentence, title)\n  //by comma-section\n  s = byClause(s)\n  //remove end period\n  s.post('')\n  // truncate a list\n  s = popList(s, options)\n  //remove article\n  if (options.article === false) {\n    s = popArticle(s)\n  }\n  //spit-out the text\n  let text = s.trim().out('text')\n  if (isGood(text, options) === true) {\n    return text\n  }\n  return ''\n}\nmodule.exports = extract\n","const fromTemplate = require('./01-fromTemplate')\nconst fromText = require('./02-fromText')\n\nconst defaults = {\n  article: true\n}\n\nconst seemsGood = function(txt) {\n  return txt && txt.length > 5 && txt.length < 55\n}\n\nconst postProcess = function(txt) {\n  txt = txt.trim()\n  return txt\n}\n\nconst plugin = function(models) {\n  // add a new method to main class\n  models.Doc.prototype.summary = function(options) {\n    let doc = this\n    options = options || {}\n    options = Object.assign({}, defaults, options)\n\n    // generate from {{short description}} template\n    let txt = fromTemplate(doc, options)\n    if (seemsGood(txt)) {\n      return postProcess(txt)\n    }\n    // generate from first-sentence\n    txt = fromText(doc, options)\n    if (seemsGood(txt)) {\n      return postProcess(txt)\n    }\n\n    return ''\n  }\n\n  // should we use 'it', 'he', 'they'...\n  models.Doc.prototype.article = function(options) {\n    return null\n  }\n  // was event in past? is person dead?\n  models.Doc.prototype.tense = function(options) {\n    return null\n  }\n}\nmodule.exports = plugin\n"],"names":["isObject","obj","Object","prototype","toString","call","fromTemplate","doc","tmpl","template","description","defaults","max","min","removeTitle","s","sentence","title","bolds","sort","a","b","length","forEach","not","byClause","orig","clone","clauses","i","c","eq","has","result","slice","popList","options","txt","text","almostMax","remove","isGood","popArticle","extract","assign","sentences","nlp","parentheses","post","article","trim","out","seemsGood","postProcess","plugin","models","Doc","summary","fromText","tense"],"mappings":"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"}