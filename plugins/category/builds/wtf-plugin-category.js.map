{"version":3,"file":"wtf-plugin-category.js","sources":["../src/index.js"],"sourcesContent":["const slow = require('slow')\n\nconst chunkBy = function(arr, chunkSize = 5) {\n  var groups = [],\n    i\n  for (i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchCat = async function(wtf, cat, lang, opts) {\n  let resp = await wtf.category(cat, lang)\n  let pages = resp.pages.map(o => o.title)\n  let groups = chunkBy(pages)\n\n  const doit = function(group) {\n    return wtf.fetch(group, opts) //returns a promise\n  }\n  //only allow three requests at a time\n  return slow.three(groups, doit).then(responses => {\n    //flatten the results\n    let docs = [].concat.apply([], responses)\n    return {\n      docs: docs,\n      categories: resp.categories\n    }\n  })\n}\n\nconst plugin = function(models) {\n  models.wtf.parseCategory = async function(cat, lang, opts) {\n    return await fetchCat(models.wtf, cat, lang, opts)\n  }\n  models.wtf.fetchCategory = models.wtf.parseCategory\n}\nmodule.exports = plugin\n"],"names":["chunkBy","arr","chunkSize","groups","i","length","push","slice","fetchCat","wtf","cat","lang","opts","category","resp","pages","map","o","title","doit","group","fetch","slow","three","then","responses","docs","concat","apply","categories","plugin","models","parseCategory","fetchCategory"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA,IAAMA,OAAO,GAAG,SAAVA,OAAU,CAASC,GAAT,EAA6B;EAAA,MAAfC,SAAe,uEAAH,CAAG;EAC3C,MAAIC,MAAM,GAAG,EAAb;EAAA,MACEC,CADF;;EAEA,OAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGH,GAAG,CAACI,MAApB,EAA4BD,CAAC,IAAIF,SAAjC,EAA4C;EAC1CC,IAAAA,MAAM,CAACG,IAAP,CAAYL,GAAG,CAACM,KAAJ,CAAUH,CAAV,EAAaA,CAAC,GAAGF,SAAjB,CAAZ;EACD;;EACD,SAAOC,MAAP;EACD,CAPD;;EASA,IAAMK,QAAQ;EAAA,qEAAG,iBAAeC,GAAf,EAAoBC,GAApB,EAAyBC,IAAzB,EAA+BC,IAA/B;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,mBACEH,GAAG,CAACI,QAAJ,CAAaH,GAAb,EAAkBC,IAAlB,CADF;;EAAA;EACXG,YAAAA,IADW;EAEXC,YAAAA,KAFW,GAEHD,IAAI,CAACC,KAAL,CAAWC,GAAX,CAAe,UAAAC,CAAC;EAAA,qBAAIA,CAAC,CAACC,KAAN;EAAA,aAAhB,CAFG;EAGXf,YAAAA,MAHW,GAGFH,OAAO,CAACe,KAAD,CAHL;;EAKTI,YAAAA,IALS,GAKF,SAAPA,IAAO,CAASC,KAAT,EAAgB;EAC3B,qBAAOX,GAAG,CAACY,KAAJ,CAAUD,KAAV,EAAiBR,IAAjB,CAAP,CAD2B;EAE5B,aAPc;;;EAAA,6CASRU,IAAI,CAACC,KAAL,CAAWpB,MAAX,EAAmBgB,IAAnB,EAAyBK,IAAzB,CAA8B,UAAAC,SAAS,EAAI;;EAEhD,kBAAIC,IAAI,GAAG,GAAGC,MAAH,CAAUC,KAAV,CAAgB,EAAhB,EAAoBH,SAApB,CAAX;EACA,qBAAO;EACLC,gBAAAA,IAAI,EAAEA,IADD;EAELG,gBAAAA,UAAU,EAAEf,IAAI,CAACe;EAFZ,eAAP;EAID,aAPM,CATQ;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,GAAH;;EAAA,kBAARrB,QAAQ;EAAA;EAAA;EAAA,GAAd;;EAmBA,IAAMsB,MAAM,GAAG,SAATA,MAAS,CAASC,MAAT,EAAiB;EAC9BA,EAAAA,MAAM,CAACtB,GAAP,CAAWuB,aAAX;EAAA,wEAA2B,kBAAetB,GAAf,EAAoBC,IAApB,EAA0BC,IAA1B;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,qBACZJ,QAAQ,CAACuB,MAAM,CAACtB,GAAR,EAAaC,GAAb,EAAkBC,IAAlB,EAAwBC,IAAxB,CADI;;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,KAA3B;;EAAA;EAAA;EAAA;EAAA;;EAGAmB,EAAAA,MAAM,CAACtB,GAAP,CAAWwB,aAAX,GAA2BF,MAAM,CAACtB,GAAP,CAAWuB,aAAtC;EACD,CALD;;EAMA,OAAc,GAAGF,MAAjB;;;;;;;;"}