{"version":3,"file":"wtf-plugin-category.js","sources":["../node_modules/slow/builds/slow.mjs","../src/_http.js","../src/_headers.js","../src/random.js","../src/index.js"],"sourcesContent":["/* slow 1.1.0 MIT */\n//only do foo promises at a time.\nvar rateLimit = function rateLimit(arr, fn) {\n  var limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n  return new Promise(function (resolve, reject) {\n    //some validation\n    if (!arr || !fn) {\n      reject('Error: missing required parameters to rate-limit function');\n      return;\n    }\n\n    if (arr.length === 0) {\n      resolve([]);\n      return;\n    }\n\n    var results = [];\n    var n = limit - 1;\n    var pending = 0; //simple recursion, but with then/finally\n\n    var go = function go(i) {\n      pending += 1;\n      var p = fn(arr[i]);\n\n      if (!p.then) {\n        reject('Error: function must return a promise');\n        return;\n      }\n\n      p.then(function (r) {\n        results[i] = r;\n      });\n      p[\"catch\"](function (e) {\n        console.error(e);\n        results[i] = null;\n      });\n      p[\"finally\"](function () {\n        pending -= 1;\n        n += 1; //should we keep going?\n\n        if (arr.length >= n + 1) {\n          go(n);\n        } else if (pending <= 0) {\n          //no more to start - are we the last to finish?\n          resolve(results);\n        }\n      });\n    }; //fire-off first-n items\n\n\n    var init = arr.length < limit ? arr.length : limit;\n\n    for (var i = 0; i < init; i += 1) {\n      go(i);\n    }\n  });\n};\n\nvar rateLimit_1 = rateLimit;\n\nvar methods = {\n  one: function one(arr, fn) {\n    return rateLimit_1(arr, fn, 1);\n  },\n  two: function two(arr, fn) {\n    return rateLimit_1(arr, fn, 2);\n  },\n  three: function three(arr, fn) {\n    return rateLimit_1(arr, fn, 3);\n  },\n  four: function four(arr, fn) {\n    return rateLimit_1(arr, fn, 4);\n  },\n  five: function five(arr, fn) {\n    return rateLimit_1(arr, fn, 5);\n  },\n  ten: function ten(arr, fn) {\n    return rateLimit_1(arr, fn, 10);\n  },\n  fifteen: function fifteen(arr, fn) {\n    return rateLimit_1(arr, fn, 15);\n  }\n};\nmethods.serial = methods.one;\nmethods.linear = methods.one;\nmethods.crawl = methods.three;\nmethods.walk = methods.five;\nmethods.run = methods.ten;\nmethods.sprint = methods.fifteen;\nvar src = methods;\n\nexport default src;\n","const https = require('https')\n\n// use the native nodejs request function\nconst request = function (url, opts = {}) {\n  return new Promise((resolve, reject) => {\n    https\n      .get(url, opts, (resp) => {\n        let data = ''\n        // A chunk of data has been recieved.\n        resp.on('data', (chunk) => {\n          data += chunk\n        })\n        // The whole response has been received. Print out the result.\n        resp.on('end', () => {\n          try {\n            let json = JSON.parse(data)\n            resolve(json)\n          } catch (e) {\n            reject(e)\n          }\n        })\n      })\n      .on('error', (err) => {\n        reject(err)\n      })\n  })\n}\nmodule.exports = request\n","const makeHeaders = function(options) {\n  let agent =\n    options.userAgent ||\n    options['User-Agent'] ||\n    options['Api-User-Agent'] ||\n    'User of the wtf_wikipedia library'\n\n  const opts = {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      'Api-User-Agent': agent,\n      'User-Agent': agent,\n      Origin: '*'\n    },\n    redirect: 'follow'\n  }\n  return opts\n}\nmodule.exports = makeHeaders\n","const http = require('./_http')\nconst makeHeaders = require('./_headers')\n\nconst defaults = {\n  lang: 'en',\n  wiki: 'wikipedia',\n  domain: null,\n  path: 'w/api.php' //some 3rd party sites use a weird path\n}\nconst isObject = function (obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\n\nconst fetchRandom = function (lang, options) {\n  options = options || {}\n  options = Object.assign({}, defaults, options)\n  //support lang 2nd param\n  if (typeof lang === 'string') {\n    options.lang = lang\n  } else if (isObject(lang)) {\n    options = Object.assign(options, lang)\n  }\n\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += `format=json&action=query&generator=random&grnnamespace=14&prop=revisions&grnlimit=1&origin=*`\n\n  const headers = makeHeaders(options)\n  return http(url, headers)\n    .then((res) => {\n      try {\n        let o = res.query.pages\n        let key = Object.keys(o)[0]\n        return o[key].title\n      } catch (e) {\n        throw e\n      }\n    })\n    .catch((e) => {\n      console.error(e)\n      return null\n    })\n}\nmodule.exports = fetchRandom\n","const slow = require('slow')\nconst random = require('./random')\n\nconst chunkBy = function (arr, chunkSize = 5) {\n  var groups = [],\n    i\n  for (i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchCat = async function (wtf, cat, lang, opts) {\n  if (!cat) {\n    return { docs: [], categories: [] }\n  }\n  let resp = await wtf.category(cat, lang)\n  let pages = resp.pages.map((o) => o.title)\n  let groups = chunkBy(pages)\n\n  const doit = function (group) {\n    return wtf.fetch(group, opts) //returns a promise\n  }\n  //only allow three requests at a time\n  return slow.three(groups, doit).then((responses) => {\n    //flatten the results\n    let docs = [].concat.apply([], responses)\n    return {\n      docs: docs,\n      categories: resp.categories\n    }\n  })\n}\n\nconst plugin = function (models) {\n  models.wtf.parseCategory = async function (cat, lang, opts) {\n    return await fetchCat(models.wtf, cat, lang, opts)\n  }\n  models.wtf.randomCategory = async function (lang, opts) {\n    return await random(lang, opts)\n  }\n  models.wtf.fetchCategory = models.wtf.parseCategory\n}\nmodule.exports = plugin\n"],"names":["rateLimit","arr","fn","limit","arguments","length","undefined","Promise","resolve","reject","results","n","pending","go","i","p","then","r","e","console","error","init","rateLimit_1","methods","one","two","three","four","five","ten","fifteen","serial","linear","crawl","walk","run","sprint","src","request","url","opts","https","get","resp","data","on","chunk","json","JSON","parse","err","makeHeaders","options","agent","userAgent","method","headers","Origin","redirect","defaults","lang","wiki","domain","path","isObject","obj","Object","prototype","toString","call","fetchRandom","assign","http","res","o","query","pages","key","keys","title","chunkBy","chunkSize","groups","push","slice","fetchCat","wtf","cat","docs","categories","category","map","doit","group","fetch","slow","responses","concat","apply","plugin","models","parseCategory","randomCategory","random","fetchCategory"],"mappings":"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"}